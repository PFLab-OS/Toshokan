paging/013: 隣の仮想メモリ
==========================

今回使用するディレクトリ：[sample/paging/013](https://github.com/PFLab-OS/Toshokan/tree/master/sample/paging/013)

今回は[この2行](https://github.com/PFLab-OS/Toshokan/blob/master/sample/paging/013/friend.cc#L56-L57)を変更しました。pt1[0]に設定するコードの0x80001000ULが0x80000000ULになっている事に気をつけてください。

さあ、また仮想メモリを覗いてみましょう。[paging/012.md](012.md)と同じコマンドを叩いてみます。

```
(qemu) cpu 1
(qemu) x /1100x 0xC0000000
00000000c0000000: 0x90661eeb 0x4a70726b 0x00097000 0x00000000
00000000c0000010: 0x80000000 0x00000000 0x00000000 0x00000000
00000000c0000020: 0x8ec88cfa 0x168b66d8 0x66670008 0x1000ba8d
＜後略＞
```

これは0x80000000からの物理メモリですね。pt1[0]の値が変化しているので、これは納得できると思います。

さてて、下の方にスクロールしていきましょう。

```
00000000c0000fe0: 0x00000000 0x00000000 0x00000000 0x00000000
00000000c0000ff0: 0x00000000 0x00000000 0x00000000 0x00000000
00000000c0001000: 0x80002027 0x00000000 0x00000000 0x00000000
00000000c0001010: 0x00000000 0x00000000 0x00000000 0x00000000
00000000c0001020: 0x00000000 0x00000000 0x00000000 0x00000000
00000000c0001030: 0x00000000 0x00000000 0x00000000 0x00000000
00000000c0001040: 0x00000000 0x00000000 0x00000000 0x00000000
```

おっと、今回は0xC0001000の所で`Cannot access memory`となっていません。それどころか、0x80001000〜の物理メモリの中身が表示されています。

pt1[0]は0xC0000000から0xC0001000までの4KBの仮想メモリと0x80000000からの物理メモリを設定するコードであると[paging/013](013.md)で推測しました。今回、[pt[1]に値を設定するコードが追加されています](https://github.com/PFLab-OS/Toshokan/blob/master/sample/paging/013/friend.cc#L57)が、これは隣の0xC0001000からの仮想メモリを設定している、と考えられそうです。

0xC0001000から設定されている仮想メモリも4KBの大きさなのでしょうか？確かめてみましょう。

```
(qemu) x /10x 0xC0001FF0
00000000c0001ff0: 0x00000000 0x00000000 0x00000000 0x00000000
00000000c0002000: Cannot access memory
```

0xC0001000に4KBを足すと0xC0002000となります。確かに0xC0002000にアクセスしようとした時点で`Cannot access memory`となりますね。

[このセクションの目次に戻る](index.md)